<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Cache-Control" content="max-age=0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Our Photo Frame</title>
<link href="static/style.css" rel="stylesheet">
<style type="text/css">
#ctrls {
	display: flex;
	margin-bottom: 0.5rem;
	padding: 0.5rem;
	border-bottom: 2px solid blueviolet;
}
.plst-ctrl {
	padding: .5rem 1rem;
	border: 1px solid blue;
	border-radius: 0.4em;
	margin-right: 1rem;
	background-color: #b3cfb3;
	color: blue;
	cursor: pointer;
}
.plst-ctrl:hover {
	background-color: #d3efd3;
}
.plst {
	cursor: pointer;
}
.plst:hover {
	background-color: aquamarine;
}
.plst.activ {
	background-color: aquamarine;
}
.plst-ttl, .plst-xtr {
	white-space: nowrap;;
}
.plst-admin {
	margin-left: auto;
	padding: .3rem;
	border: 1px solid #CCC;
	height: min-content;
	border-radius: 5px;
	color: blue;
	cursor: pointer;
	display: none;
}
#thumbs {
	display: flex;
	flex-wrap: wrap;
	gap: 6px;
}
</style>
</head>
<body>
<div id="ctrls">
	<div class="plst-ctrl" data-act="prev">Previous</div>
	<div class="plst-ctrl" data-act="next">Next</div>
	<div class="plst-ctrl" data-act="thms">Thumbnails</div>
	<div class="plst-admin" data-act="admin">Admin</div>
</div>
<div id="plists">
</div>
<div id="thumbs">
<div>
<script>
	var actvl = null;
	var thmsURL = '';
	document.getElementById('ctrls').addEventListener('click', evt => {
		console.log(evt);
		let aem = evt.target;
		let act = aem.dataset.act;
		if (act) {
			if (act=='admin') window.location = '/admin';
			if (act=='thms') return displayThumbs();
			fetch(galURL+'/?cmd='+act, {method:'GET'})
			.then(resp => { console.log(resp); if (!resp.ok) throw new Error(`HTTP ${resp.status}`); if (true) return resp.json(); else return resp.text() })
			.then(data => {
				console.log(data);
			})
			.catch(err => alert('Failure: '+err));
		}
	});
	document.getElementById('plists').addEventListener('click', evt => {
		console.log(evt);
		let lem = evt.target;
		let pln = lem.dataset.pln;
		if (!pln) { lem = lem.parentElement; pln = lem.dataset.pln; }
		if (pln) {
			fetch(galURL+'/?list='+pln, {method:'GET'})
			.then(resp => { console.log(resp); if (!resp.ok) throw new Error(`HTTP ${resp.status}`); if (true) return resp.json(); else return resp.text() })
			.then(data => {
				console.log(data);
				if (actvl) actvl.classList.remove('activ');
				lem.classList.add('activ');
				actvl = lem;
				thmsURL = lem.dataset.plk;
				document.getElementById('thumbs').innerHTML = '';
			})
			.catch(err => alert('Failure: '+err));
		}
	});
	if (localStorage.getItem('adminok')) {
		let admb = document.querySelector('.plst-admin');
		admb.style.display = 'block';
	}
	const galURL = 'http://picframe.local';
	const getList = () => {
		fetch(galURL+'/?cmd=lists', {method:'GET'})
		.then(resp => { console.log(resp); if (!resp.ok) throw new Error(`HTTP ${resp.status}`); if (true) return resp.json(); else return resp.text() })
		.then(data => {
			console.log(data);
			if (!data.lists.length) {
				document.getElementById('plists').innerHTML = '<h2>NO PLAYLISTS WERE FOUND</h2>';
				return;
			}
			let curr = data.curlst;
			let lnks = data.lists.map(lst => {
				if (lst.ttl==curr) thmsURL = lst.plk;
				let act = lst.ttl==curr ? ' activ' : '';
				let ttl = atob(lst.ttl);
				return `<div class="plst${act}" data-pln="${lst.ttl}" data-plk="${lst.plk}"><div class="plst-ttl">${ttl}</div><div class="plst-xtr">${lst.pcnt} Photos : ${lst.sdly} Seconds</div></div>`;
			});
			document.getElementById('plists').innerHTML = lnks.join('');
			actvl = document.querySelector('.plst.activ');
		})
		.catch(err => alert('Failure: '+err));
	}
	const displayThumbs = () => {
		if (!thmsURL) return
		fetch(thmsURL+'&act=thms', {method:'GET'})
		.then(resp => { console.log(resp); if (!resp.ok) throw new Error(`HTTP ${resp.status}`); if (false) return resp.json(); else return resp.text() })
		.then(data => {
			console.log(data);
			document.getElementById('thumbs').innerHTML = data;
		})
		.catch(err => alert('Failure: '+err));
	}
	getList();
</script>
</body>
</html>

